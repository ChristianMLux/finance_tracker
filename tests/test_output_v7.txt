============================= test session starts =============================
platform win32 -- Python 3.13.2, pytest-9.0.2, pluggy-1.6.0
rootdir: C:\Users\chris\Documents\coding_projects\finance_tracker
configfile: pytest.ini
plugins: anyio-4.12.0, asyncio-1.3.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collected 2 items

tests\test_analytics.py F.                                               [100%]

================================== FAILURES ===================================
__________________________ test_analytics_allocation __________________________

client = <httpx.AsyncClient object at 0x000001A187381FD0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x000001A187382120>

    @pytest.mark.asyncio
    async def test_analytics_allocation(client, db_session):
        # Seed data
        # Check if user exists, if not create
>       result = await db_session.execute("SELECT * FROM users WHERE id = 'test_user_123'")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_analytics.py:61: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py:449: in execute
    result = await greenlet_spawn(
.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py:190: in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2351: in execute
    return self._execute_internal(
.venv\Lib\site-packages\sqlalchemy\orm\session.py:2147: in _execute_internal
    statement = coercions.expect(roles.StatementRole, statement)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\sqlalchemy\sql\coercions.py:396: in expect
    resolved = impl._literal_coercion(
.venv\Lib\site-packages\sqlalchemy\sql\coercions.py:622: in _literal_coercion
    return self._text_coercion(element, argname, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\sqlalchemy\sql\coercions.py:615: in _text_coercion
    return _no_text_coercion(element, argname)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

element = "SELECT * FROM users WHERE id = 'test_user_123'", argname = None
exc_cls = <class 'sqlalchemy.exc.ArgumentError'>, extra = None, err = None

    def _no_text_coercion(
        element: Any,
        argname: Optional[str] = None,
        exc_cls: Type[exc.SQLAlchemyError] = exc.ArgumentError,
        extra: Optional[str] = None,
        err: Optional[Exception] = None,
    ) -> NoReturn:
>       raise exc_cls(
            "%(extra)sTextual SQL expression %(expr)r %(argname)sshould be "
            "explicitly declared as text(%(expr)r)"
            % {
                "expr": util.ellipses_string(element),
                "argname": "for argument %s" % (argname,) if argname else "",
                "extra": "%s " % extra if extra else "",
            }
        ) from err
E       sqlalchemy.exc.ArgumentError: Textual SQL expression 'SELECT * FROM users WHERE...' should be explicitly declared as text('SELECT * FROM users WHERE...')

.venv\Lib\site-packages\sqlalchemy\sql\coercions.py:585: ArgumentError
============================== warnings summary ===============================
backend\database.py:22
  C:\Users\chris\Documents\coding_projects\finance_tracker\backend\database.py:22: MovedIn20Warning: The ``declarative_base()`` function is now available as sqlalchemy.orm.declarative_base(). (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    Base = declarative_base()

tests/test_analytics.py::test_analytics_cashflow
  C:\Users\chris\Documents\coding_projects\finance_tracker\tests\test_analytics.py:90: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    today = datetime.utcnow()

tests/test_analytics.py::test_analytics_cashflow
  C:\Users\chris\Documents\coding_projects\finance_tracker\.venv\Lib\site-packages\sqlalchemy\sql\schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

tests/test_analytics.py::test_analytics_cashflow
  C:\Users\chris\Documents\coding_projects\finance_tracker\backend\routers\analytics.py:39: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    start_date = datetime.utcnow() - timedelta(days=days)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/test_analytics.py::test_analytics_allocation - sqlalchemy.exc.Ar...
=================== 1 failed, 1 passed, 4 warnings in 2.76s ===================
